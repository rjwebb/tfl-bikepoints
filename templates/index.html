{% extends "base_layout.html" %}
{% block title %}All locations{% endblock %}

{% block extra_head %}
<!-- Leaflet.js stuff (mapping) -->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

<!-- Library for clustering markers together -->
<script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"></script>
<link href="https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css" rel="stylesheet" />
<link href="https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css" rel="stylesheet" />

<!-- Library for nice custom icons -->
<link href="{{ url_for('static', filename='leaflet.awesome-markers.css') }}" rel="stylesheet" />
<link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<script src="{{ url_for('static', filename='leaflet.awesome-markers.min.js') }}"></script>

{% endblock %}

{% block errors %}
{% if error %}
<div class="error">Error: {{ error }}</div>
{% endif %}
{% endblock %}

{% block heading %}
All bicycle hire locations
{% endblock %}

{% block content %}
<div id="map"></div>

<div class="list-group">
  {% for bikepoint in bikepoints %}
  <a href="/bikepoint/{{bikepoint.id}}" class="list-group-item">
    {{bikepoint.commonName}}
  </a>
  {% endfor %}
</div>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript">
L.AwesomeMarkers.Icon.prototype.options.prefix = 'ion';

// the locations of the bicycle hire locations
var marker_data = {{ marker_data | safe }};

// create the map
var map = L.map('map').setView([51.498, -0.119], 12);
L.tileLayer('https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png',{
    attribution: 'Maps &copy; Thunderforest, Data\
        &copy; OpenStreetMap contributors.'
}).addTo(map);

// create the markers
var markers = new L.MarkerClusterGroup();
for(var i=0;i < marker_data.length;i++){
    var m = marker_data[i];
    var marker = L.marker(m.pos, {
	title: m.commonName,
	icon: L.AwesomeMarkers.icon({
	    icon: 'ion-android-bicycle',
	    markerColor: 'red'
	})
    });
    markers.addLayer(marker);
}
map.addLayer(markers);

// add the scale bar
L.control.scale().addTo(map);
</script>
{% endblock %}
